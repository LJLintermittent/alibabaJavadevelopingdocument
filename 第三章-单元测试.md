# 《阿里巴巴Java开发手册--部分重点摘录与分析》

## 第三章 单元测试

* 【强制】好的单元测试必须遵守AIR原则

  ~~~wiki
  单元测试在线上运行时，像空气一样感觉不到，但在测试质量的保障方面，却是十分关键的，从宏观上来说，好的单元测试具有自动化，独立性，可重复执行的特点
  A：Automic(自动化)
  I：Independent(独立性)
  R：Repeatable(可重复)
  ~~~

* 【强制】单元测试中不准使用System.out进行人肉验证，必须使用assert验证

* 【强制】保持单元测试的独立性，为了保证单元测试稳定可靠且便于维护，单元测试用例之间决不能互相调用，也不能依赖执行的先后顺序

* 【强制】单元测试是可以重复执行的，不能受到外界环境的影响。

  ~~~wiki
  说明：
  单元测试经常会被放到持续集成中，每次有代码check in时，单元测试都会被执行。如果单元测试对网络，服务，中间件等外部环境有依赖，则容易导致持续集成机制不可用
  正例：
  为了不受外界环境影响，要求设计代码时就把SUT的依赖改成注入，在测试时用Spring这样的DI框架注入一个本地(内存)实现或者Mock实现
  ~~~

* 【强制】对于单元测试，要保证测试粒度足够小，有助于精确定位问题，单元测试粒度至多是类级别，一般是方法级别

  ~~~wiki
  说明：只有测试粒度足够小，才能在出错时尽快定位到出错位置。单元测试不负责检查跨类或者跨系统的交互逻辑，那是集成测试的领域。
  ~~~

* 【强制】核心业务，核心应用，核心模块的增量代码确保通过单元测试

  ~~~wiki
  说明：新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正
  ~~~

* 【强制】单元测试代码必须写在如下工程目录下：src/test/java,不允许写在业务代码目录下

  ~~~wiki
  说明：源码编译会跳过此目录，而单元测试框架默认扫描此目录
  ~~~

* 【推荐】编写单元测试代码遵守BCDE原则，以保证被测试模块的交付质量

  ~~~wiki
  说明：
  B：Border，边界值测试，包括循环边界，特殊取值，特殊时间点和顺序等
  C：Correct，正确的输入，并得到预期的结果
  D：Design，与设计文档相结合，编写单元测试
  E：Error，强制错误信息输入，(如，非法数据，异常流程，业务允许输入等)，并得到预期的结果
  ~~~

* 【推荐】和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者对单元测试产生的数据有明确的前后缀标识

* 【推荐】对于不可测的代码，在适当的时机做必要的重构，使代码变得可测，避免为了达到测试要求而书写不规范的测试代码

## 阿里巴巴Java开发手册 第三章重点摘录完结

