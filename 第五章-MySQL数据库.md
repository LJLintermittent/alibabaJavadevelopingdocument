# 《阿里巴巴Java开发手册--部分重点摘录与分析》

## 第五章 MySQL数据库

### 建表规约

* 【强制】表达是与否的概念的字段，必须使用is_xxx的方式命名，数据类型是unsigned tinyint(1表示是，0表示否)

  ~~~wiki
  说明：任何字段如果为非负数，则必须是unsigned
  注意：POJO类中的任何布尔类型的变量，都不要加is前缀，需要在<resultMap>中设置从is_xxx到xxx的映射关系。数据库表示是与否的值，使用tinyint类型，坚持is_xxx的命名方式是为了明确其取值含义与取值范围
  正例：表达逻辑删除的字段名is_deleted，1表示删除，0表示未删除
  ~~~

* 【强制】表名，字段名必须使用小写字母或数字，禁止出现数字开头，禁止是在两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑

  ~~~wiki
  说明：
  MySQL在windows系统中是不区分大小写的，但在Linux系统中默认区分大小写。因此，数据库名，表明，字段名都不允许出现任何大写字母，避免节外生枝
  ~~~

* 【强制】表名不使用复数名词

  ~~~wikii
  说明：表名应该仅仅表示表里面的实体内容，不应该表示实体数量，对应到DO类也是单数形式
  ~~~

* 【强制】禁用保留字，如desc，range，match，delayed等，请参考MySQL官方保留字

* ~~~wiki
  【强制】主键索引名为pk_字段名，唯一索引名为uk_字段名，普通索引名为idx_字段名
  ~~~

* 【强制】小数类型为decimal，禁止使用float和double类型

  ~~~wiki
  说明：在存储时，float和double存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过decimal的范围，那么建议将数据拆成整数和小数并分开存储
  ~~~

* 【强制】如果存储的字符串长度几乎相等，则使用char定长字符串类型

* 【强制】varchar是可变长字符串，不预先分配存储空间，长度不要超过5000个字符，如果存储长度大于此值，则应定义字段类型为text，独立出来一张表，用主键来对应，避免影响其他字段的索引效率

* 【强制】表必备三个字段，id，update_time，create_time

  ~~~wiki
  说明：其中id必为主键，类型为bigint unsigned，单表时主键自增，步长为1，update_time和create_time字段类型必须为date_time
  ~~~

* 【推荐】表的命名最好遵循"业务名称_表的作用"原则

  ~~~wiki
  正例：alipay_task/froce_project/trade_config 
  ~~~

* 【推荐】库名与应用名称尽量一致

* 【推荐】当修改字段含义或追加字段表示的状态时，需要及时更新字段注释

* 【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致性，冗余字段应遵循以下原则

  ~~~wiki
  1)不是频繁修改的字段
  2)不是唯一索引的字段
  3)不是varchar超长字段，更不能是text字段
  正例：各业务线经常冗余存储商品名称，避免查询时需要调用基础服务获取
  ~~~

* 【推荐】当单表行数超过500万或者单表容量超过2GB时，才推荐分库分表

  ~~~wiki
  说明：如果预计三年后的数据量无法达到这个级别，请不要在创建表时就分库分表
  ~~~

* 【参考】设置合适的字符存储长度，不但可以节约数据库表空间和索引存储，更重要的是能够提升检索速度
